# Full PHPUnit Test Suite Run Plan

Goal
----
Run the entire PHPUnit suite for the repository to validate that recent schema and service-test changes didn't introduce regressions.

Scope
-----
- All PHPUnit tests under `backend/tests` (Unit, Feature, any other test folders referenced by `phpunit.xml`).
- Produce a JUnit XML (`tests-results.xml`) for CI/triage.

Pre-flight checks (must pass)
-----------------------------
1. Working directory: `h:/project/web-platform/backend`.
2. Composer dependencies installed: `composer install --no-interaction --prefer-dist`.
3. PHP CLI is available and matches project expectations (run `php -v` if needed).
4. `./vendor/bin/phpunit` exists and is executable.
5. Application caches cleared to avoid stale config:
   - `php artisan config:clear`
   - `php artisan cache:clear`
   - `php artisan route:clear` (optional)
6. Optional: ensure app key exists: `php artisan key:generate --ansi` (safe, idempotent).
7. Ensure no long-running processes that might lock files.

Run commands
------------
Use PowerShell from project backend folder.

Pre-flight (recommended):
```powershell
cd "h:/project/web-platform/backend"
composer install --no-interaction --prefer-dist
php artisan key:generate --ansi
php artisan config:clear
php artisan cache:clear
```

Run full PHPUnit with JUnit output:
```powershell
cd "h:/project/web-platform/backend"
./vendor/bin/phpunit --colors=always --log-junit tests-results.xml
```

Quick failure-first run (fast detection):
```powershell
./vendor/bin/phpunit --stop-on-failure
```

Triage workflow if failures appear
---------------------------------
1. Inspect `tests-results.xml` for failing tests and stack traces.
2. Re-run the failing tests directly to get full output:
   - `./vendor/bin/phpunit --filter ClassNameTest`
   - or `./vendor/bin/phpunit tests/Unit/Path/To/FailingTest.php`
3. Categorize failure:
   - DB/migration mismatch: inspect migration + factory; prefer adding a new migration over editing historical migrations.
   - Test vs service mismatch: update tests to call the correct API or adjust service if behavior is wrong.
   - Missing PHP extension (e.g., ext-gd): either mock around it in tests (use `UploadedFile::fake()->create(...)`) or document the platform requirement.
   - External integrations: ensure fakes/mocks are used for HTTP/Queue/Storage where suitable.
4. Implement targeted fix (up to 3 attempts).
   - For schema fixes, prefer creating a new migration that alters the table.
   - For test fixes, prefer making tests DB/dialect-agnostic (use `whereDate`, defensive type handling, etc.).
5. Re-run failing tests until all pass or until manual escalation is needed.

Artifacts
---------
- `backend/tests-results.xml` — JUnit XML results produced by PHPUnit.
- Console logs captured from the run.

Quality gates
-------------
- Composer: PASS if `composer install` completes.
- PHPUnit: PASS if no failures or errors.
- Lint/Typecheck: optional, not required here (project may not have these configured).

Rollback / remediation notes
---------------------------
- If a schema change must be reverted, prefer creating an *additional* migration that reverts the change rather than editing historical migrations if the repo is shared.
- If a test needs to be adjusted to align with intended behavior, update the test and add a small comment explaining the rationale.

Timing estimate
---------------
- Pre-flight: < 2 minutes.
- Full test suite: variable — typically 2–10 minutes depending on suite size. If many feature/HTTP tests exist the run could be longer.

Acceptance criteria
-------------------
- `./vendor/bin/phpunit` finishes with 0 failures and 0 errors.
- `tests-results.xml` generated and available in `backend/`.

Contact points
--------------
If any failure requires changes beyond minor test fixes (database design changes, migration rework that affects production), I'll pause and provide the failing traces and a recommendation before applying those changes.


---

Saved on: 2025-10-14
Generated by automation: comprehensive test-run plan for repository `ElderCare-SG-Compassionate-Daycare-Solutions`.
